import pandas as pd
import numpy as np

def clean_types(df):
    for col in df.columns:
        if 'age' in col.lower() or 'income' in col.lower():
            df[col] = pd.to_numeric(df[col].astype(str).str.replace(r'[$,?]', '', regex=True), errors='coerce')
    return df

def clean_missing(df):
    df = df.ffill().bfill()
    return df

def outliers(df):
    numeric_cols = df.select_dtypes(include=[np.number]).columns
    for col in numeric_cols:
        q1 = df[col].quantile(0.25)
        q3 = df[col].quantile(0.75)
        iqr = q3 - q1
        lower = q1 - 1.5 * iqr
        upper = q3 + 1.5 * iqr
        df[col] = df[col].clip(lower, upper)
    return df

def clean_strings_and_dates(df):
    for col in df.select_dtypes(include=['object', 'string']).columns:
        df[col] = df[col].str.strip().str.lower()
        if 'date' in col.lower() or 'time' in col.lower():
            df[col] = pd.to_datetime(df[col], errors='coerce')
    return df

def v_cleaned(df):
    checks = {
        "null_count": df.isnull().sum().sum(),
        "df_shape": df.shape,
        "types": df.dtypes.to_dict()
    }
    return checks

def clean_data(df):
    df = clean_types(df)
    df = clean_strings_and_dates(df)
    df = clean_missing(df)
    df = outliers(df)
    return df

path = r"C:\Users\acer61\Downloads\day14_users_raw.csv"
raw_df = pd.read_csv(path)

cleaned_df = clean_data(raw_df)
v_results = v_cleaned(cleaned_df)

print("Validation Results:\n", v_results)
print("\nHead of cleaned data:")
print(cleaned_df.head())
